## 版本2

### 问题一

在服务器进程终止时，会向客户端发送FIN，客户端接收FIN后会发送ACK，同时在read的缓冲区后写EOF，但是由于我们的客户端阻塞在fgets，导致客户端不能及时获取进程终止信息。

需要使用select函数进行处理。

### 问题二

在客户端发送完数据遇到EOF后，客户端就关闭了，但是此时可能还有一些数据正在发送的路上或者返回的路上，不能显示到标准输出。

需要使用shutdown函数

设置完shutdown函数后就不必监测终端输入了，到那时仍然要监测套接字，知道套接字中的所有数据都被读完，退出函数（即关闭套接字）。

### 问题三

select函数会在有新的数据传来的时候返回，但是如果用户并没有一次将缓冲区中的所有数据都读完，select不会再次返回。也就是说select面向read函数而不是fgets函数。

我们需要使用read函数从描述符中读取数据，以避免这种问题。


### 说明

select，shutdown，poll函数使用说明，参见socket/FunctionSys.md

### 程序说明

程序仿照Unix网络编程的第六章的select函数使用例程编写。

只是在自己实现的过程中没有维护client最大下标以及select返回值的信息，从而导致每次都要遍历整个client数组。不过程序结构和功能是完整，可以正常使用。再次暂时不做修改。

同时书上还是用poll函数实现了更新版本的服务器程序，由于原理相同，在此也不做实现。

本例程仍然存在问题。当客户端不输入回车时，服务器程序的read函数不会返回，这会导致服务器阻塞在当前客户，不能为其他客户服务，这样产生了拒绝服务攻击问题。解决方案将在后面给出。
