## 线程

同一进程的所有线程共享全局变量和描述符，但引入了同步问题，必须使用的Pthread的同步原语是互斥锁和条件变量。

原语：原子操作

并行：同时执行，受限于处理器个数。

并发：在假设处理器无限的理想情况下，所能提供的最大并行度。

内核级线程，也称为热线程，能够独立地调度和派遣到某个处理器上运行的基本轻权对象（相对于进程），用于内核根据内部需要进行操作的。对于应用程序不可见。

轻权进程，属于热线程，每个轻权进程绑定到各自的内核线程上。

用户线程，是冷线程，由线程库操作。

PTHREAD_SCOPE_SYSTEM用于指定一个线程是一个轻权进程，其和其他进程中的线程争夺资源。

PTHREAD_SCOPE_PROCESS用于指定一个线程是一个用户级线程，其和本进程中的线程争夺资源。

一个线程可能是可汇合的（joinable，默认），或者是脱离的（detached）。可汇合的进程终止时，它的线程ID和退出状态会保留到另一个线程对起调用pthread_join。脱离的线程结束时，直接释放所有的资源。

### 线程特定数据

用来将使用了全局变量，静态变量的函数修改成线程安全的函数。

#### 进程维护的结构

进程维护一个数组，其元素为一个结构体，包含一个标志变量和一个析构函数指针变量。

标志变量：用来标志这个元素是否正在使用，初始化为不在使用。在使用的含义是指，线程中调用的某个函数使用了该元素对应的下标，来存储自己的数据到线程自己维护的一个相同大小数组中（相同大小指定是元素个数，而不是存储空间）。

析构函数指针变量：用来存储析构函数指针。用来在线程结束时，以各线程自己维护的数组中存储的数据指针为参数，释放对应的存储空间。

#### 线程维护的结构

线程维护一个和进程大小相同（相同大小指定是元素个数，而不是存储空间）的一维数组，其元素为一个指针。指针指向线程调用的某个函数用到的数据（全局或者静态数据）。

### 线程编程

又称为并发编程，或并行编程。这是多个线程可能同时访问同一个全局变量，这可能产生错误。而这种错误一般很难发现，且很难复现。

一种解决办法是使用互斥锁。

#### 函数参见funcSys.md

#### 条件变量

通知其他线程某个条件满足，等待该条件满足的函数可以继续执行。

条件变量需要和互斥锁搭配使用。因为条件变量本身就是一个全局变量，需要互斥锁对自己进行保护。

互斥锁的作用是在自己访问的时候限制其他线程访问。而条件变量的作用是在其他线程没有做出某个动作前，限制自身的继续执行。
